# Denoã°ãŸä¼šè­° Monthly ç¬¬7å›
2022å¹´3æœˆ20æ—¥é–‹å‚¬ã€‚  
[connpassãƒªãƒ³ã‚¯](https://deno-ja.connpass.com/event/240316/)ã€‚

## ä»Šæœˆã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’è¿½ã†
Denoã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’è¿½ã£ã¦ã„ãLTã€‚  
Discordä¸Šã®ä¼šè©±ã¯ã‚¶ãƒƒã‚¯ãƒªã¨ç®‡æ¡æ›¸ãã€‚

[@uki00aã•ã‚“ã®ã‚¹ãƒ©ã‚¤ãƒ‰](https://uki00a.github.io/slides/denobata-2022-03-20)

### [Deno v1.20](https://deno.com/blog/v1.20)
#### `permissions`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ™å‹•ãŒå¤‰æ›´ï¼ˆç ´å£Šçš„å¤‰æ›´ï¼‰
`Deno.test`ã®`permissions`ã§æ˜ç¤ºã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç„¡åŠ¹åŒ–ã•ã‚Œã¦ãŠã‚‰ãšã€ç›´æ„Ÿçš„ã§ã¯ãªã‹ã£ãŸã®ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç„¡åŠ¹åŒ–ã«å¤‰æ›´ã•ã‚ŒãŸã€‚

#### `deno task`ã‚³ãƒãƒ³ãƒ‰
deno.jsonã«ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã™ã‚‹ã“ã¨ã§ã€`deno task start`ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œå¯èƒ½ã«ãªã‚‹
``` json
{
  "tasks": {
    "start": "deno run --allow-net mod.ts"
  }
}
```

#### `deno bench`ã‚³ãƒãƒ³ãƒ‰
`Deno.bench`ã®å†…éƒ¨ã«é–¢æ•°ã‚’æ›¸ãã€`deno bench --unstable`ã¨æ›¸ãã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å–å¾—ã§ãã‚‹ã€‚

``` typescript
Deno.bench("URL parsing", () => {
  new URL("https://deno.land");
});
```

#### HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è‡ªå‹•åœ§ç¸®
ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™å ´åˆã€Denoã®ãƒã‚¤ãƒ†ã‚£ãƒ–HTTPã‚µãƒ¼ãƒãƒ¼ï¼ˆ`std@0.130.0/http/server.ts`ã®`serve`ãªã©ï¼‰ãŒHTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è‡ªå‹•åœ§ç¸®ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒgzipã¾ãŸã¯brotliåœ§ç¸®ã®ã„ãšã‚Œã‹ã‚’ã‚µãƒãƒ¼ãƒˆ
- åœ§ç¸®å¯èƒ½ãªContent-Typeã§ã‚ã‚‹ã“ã¨
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒ20ãƒã‚¤ãƒˆä»¥ä¸Š

åœ§ç¸®å¾Œã¯ã€[`Content-Encoding`ãƒ˜ãƒƒãƒ€ãƒ¼](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Content-Encoding)ã‚’è¨­å®šã—ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’åæ˜ ã€[`Vary`ãƒ˜ãƒƒãƒ€ãƒ¼](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Vary)ã‚’èª¿æ•´ã—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ã‚’è¿½åŠ ã™ã‚‹ã€‚

#### `deno test --trace-ops`
`Deno.test`ã§ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯æ¤œå‡ºæ™‚ã®ã‚¨ãƒ©ãƒ¼å†…å®¹ãŒæ”¹å–„ã•ã‚Œã‚‹ã€‚

#### `Deno.connect`ã®APIãŒå¤‰æ›´
ä»Šã¾ã§ã¯`Deno.Conn`ã¨ã„ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¦ã„ãŸãŒã€`transport: "tcp"`ã‚’æŒ‡å®šã™ã‚‹ã¨`Deno.TcpConn`ã€`transport: "unix"`ã‚’æŒ‡å®šã™ã‚‹ã¨`Deno.UnixConn`ãŒè¿”ã£ã¦ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚  
Deno.Connã«å®šç¾©ã•ã‚Œã¦ã„ãŸ`setNoDelay()`ã‚„`setKeepAlive()`ã¯`Deno.TcpConn`ã«ç§»å‹•ã—ã¦ã„ã‚‹ã€‚

#### `Deno.listenTls`ã§`cert`ã¨`key`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆ
å…ƒã€…å­˜åœ¨ã—ã¦ã„ãŸ`certFile`ã¨`keyFile`ã¯éæ¨å¥¨åŒ–ã€‚

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
Opï¼ˆã¨ã„ã†å‘½ä»¤å˜ä½ï¼‰ã®å‘¼ã³å‡ºã—ãŒæœ€å¤§ã§60%ç¨‹åº¦ã¾ã§é«˜é€ŸåŒ–ã€‚ã¾ãŸã€`atob`/`btoa`ã‚‚æœ€å¤§20å€ã»ã©ã®æ”¹å–„ãŒã•ã‚Œã¦ã„ã‚‹ã€‚

#### TypeScriptãŒ`v4.5.2`ã‹ã‚‰`v4.6.2`ã¸ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
[ã‚¿ã‚°ä»˜ããƒ¦ãƒ‹ã‚ªãƒ³ãŒã•ã‚‰ã«é€²åŒ–ã™ã‚‹](https://zenn.dev/uhyo/articles/ts-4-6-destructing-unions)ãªã©ã®æ›´æ–°å†…å®¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã€‚  
è©³ç´°ã¯[å…¬å¼ãƒ–ãƒ­ã‚°æŠ•ç¨¿](https://devblogs.microsoft.com/typescript/announcing-typescript-4-6/)ã‚’å‚ç…§ã€‚

#### deno.json(c)ã§importMapã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆ

#### `Deno.upgradeHttp()`ãŒè¿½åŠ 

#### `AbortSignal.timeout()`ãŒå®Ÿè£…

### deno_std
#### Web Streams APIã¸ã®æ®µéšçš„ç§»è¡Œ
å¤šãã®deno_stdãŒ`Deno.Writer`/`Deno.Reader`ã¨ã„ã£ãŸGoã‚¹ã‚¿ã‚¤ãƒ«ã§å®Ÿæ–½ã•ã‚Œã¦ã„ãŸãŒã€ãã‚Œã‚‰ã‚’å¾ã€…ã«Web Streams APIã«ç§»è¡Œã—ã¦ã„ãã€‚  
é€²æ—ã¯ä»¥ä¸‹Issueã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚  
https://github.com/denoland/deno_std/issues/1986

uki00aã•ã‚“ã‚‚[`encoding/csv`ã®ç§»è¡Œä½œæ¥­](https://github.com/denoland/deno_std/pull/1993)ã«æºã‚ã£ã¦ã„ã‚‹ã€‚

#### `dotenv`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¿½åŠ 

#### `deno_std/node`ã®æ”¹å–„
[node-mysql2](https://github.com/sidorares/node-mysql2)ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚ã‚‹ç¨‹åº¦å‹•ãã‚ˆã†ã«ãªã£ãŸæ¨¡æ§˜ã€‚  
deno_stdã®ãƒªãƒã‚¸ãƒˆãƒªã«[example](https://github.com/denoland/deno_std/blob/0.130.0/node/integrationtest/mysql2-example.js)ãŒã‚ã‚‹ã€‚

### [deno.landãŒNode.jsã‹ã‚‰Denoã¸ç§»è¡Œ](https://github.com/denoland/dotland/pull/2016)
Next.js/TailwindCSS/Vercelã‹ã‚‰Fresh/Twind/Deno Deployã«ç§»è¡Œã€‚

### [Freshã§Island architectureãŒå®Ÿè£…](https://github.com/lucacasonato/fresh/pull/97)

FreshãŒã€éƒ¨åˆ†çš„ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§Webã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹Island architectureã§å®Ÿè£…ã•ã‚ŒãŸã€‚  
ãã‚Œã«ä¼´ã„ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®è¦‹ç›´ã—ã‚„`useData()`ã‚„`<Suspence>`ãªã©ã®å‰Šé™¤ã‚‚è¡Œã‚ã‚ŒãŸã€‚`<Suspence>`ã¯å†åº¦è¿½åŠ äºˆå®šã¨ã®ã“ã¨ã€‚

### Remix v1.2.0ã§ã®å®Ÿé¨“çš„ãªDenoã‚µãƒãƒ¼ãƒˆ
Remix v1.2.0ã‹ã‚‰ã€ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§Denoã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ§‹ç¯‰ã•ã‚Œã‚‹ã€‚

``` bash
yarn create remix --template deno-ts
```

### oakã®Node.jsã‚µãƒãƒ¼ãƒˆ
dntã‚’åˆ©ç”¨ã—ã¦oakãŒNode.jsã‚’ã‚µãƒãƒ¼ãƒˆã€‚[`@oakserver/oak`](https://www.npmjs.com/package/@oakserver/oak)ã¨ã„ã†åç§°ã§npmã«ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ã‚‹ã€‚  
ç¾åœ¨ã¯10.3.0ã¨10.4.0ã€10.5.0ãŒãƒªãƒªãƒ¼ã‚¹æ¸ˆã¿ã€‚

Denoå…¬å¼ãƒ–ãƒ­ã‚°ã«[è§£èª¬è¨˜äº‹](https://deno.com/blog/dnt-oak)ãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã€‚

## å‚è€ƒè³‡æ–™
ä¸Šè¨˜ã‚’ã¾ã¨ã‚ã‚‹éš›ã«çœºã‚ã€ã‹ã¤ä¸Šè¨˜ã®ä¸­ã«å«ã‚ã‚‰ã‚Œãªã‹ã£ãŸè³‡æ–™ã§ã™ã€‚  
åå‰ã ã‘æ ã£ã¦ã¦é–¢ä¿‚ãªã„è³‡æ–™ã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã€ã¾ã¨ã‚ã‚‹ä½œæ¥­ã®å¯è¦–åŒ–ã¨ã—ã¦æ®‹ã—ã¦ã„ã¾ã™ã€‚  
èª­ã¾ãªãã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

- [Accept-Encoding - HTTP | MDN](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Accept-Encoding)
- [HTTP Server APIs | Manual | Deno](https://deno.land/manual@v1.20.1/runtime/http_server_apis#automatic-body-compression)
- [deno::Op - Rust](https://docs.rs/deno/0.3.10/deno/type.Op.html)
- [denosaurs/deno_json_op: ğŸ“‹ A macro for easing the development of deno plugins](https://github.com/denosaurs/deno_json_op)
- [Partial Hydration in Astro ğŸš€ Astro Documentation](https://docs.astro.build/en/core-concepts/component-hydration/#concept-island-architecture)
- [Islands Architecture - JASON Format](https://jasonformat.com/islands-architecture/)
- [Architecture | fresh docs](https://fresh.deno.dev/docs/concepts/architechture)
- [lucacasonato/fresh: Preact, but super edgy](https://github.com/lucacasonato/fresh/)
